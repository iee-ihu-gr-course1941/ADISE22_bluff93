# ADISE22_bluff93

Παιχνίδι με χαρτιά "Μπλόφα", στην NodeJS (developer: Νένα Μιχαηλίδου)

## Μπλόφα

Μπλόφα είναι ένα παιχνίδι που παίζεται με τράπουλα. Σκοπός είναι να λες μπλόφες (ψέματα) για τα φύλλα που ρίχνεις ώστε να νικήσεις. Όταν παίζει κάποιος δεν χρειάζεται να ρίχνει τα φύλλα με τον ίδιο αριθμό αλλά να λέει ότι το έκανε ώστε να ξεφορτωθεί όλα του τα φύλλα και να κερδίσει την παρτίδα. (source: [Μπλόφα (χαρτοπαίγνιο)](<https://el.wikipedia.org/wiki/%CE%9C%CF%80%CE%BB%CF%8C%CF%86%CE%B1_(%CF%87%CE%B1%CF%81%CF%84%CE%BF%CF%80%CE%B1%CE%AF%CE%B3%CE%BD%CE%B9%CE%BF)>))

## Κανόνες παιχνιδιού

-   Κάθε παίχτης πρέπει να συνδεθεί αρχικά στο παιχνίδι (χωρίς password)
-   Ο παίκτης θα πρέπει είτε να δημιουργήσει καινούριο παιχνίδι είτε να πάρει μέρος σε υπάρχον παιχνίδι
-   Το παιχνίδι παίζετε με **2 παίκτες**. Όταν ένα παιχνίδι γεμίσει, τότε όλοι οι παίκτες μοιράζονται τα χαρτιά τυχαία (οι Joker κάρτες δεν παίζουν).
-   Σε κάθε γύρο, ο παίκτης μπορεί είτε να κάνει μια δήλωση και να πετάξει χαρτιά είτε να προκαλέσει τη δήλωση του προηγούμενου παίκτη (αν υπάρχει).
-   Σκοπός του παιχνιδιού είναι να πετάξουν οι παίκτες όλα τα χαρτιά τους.
-   Νικητής είναι ο παίκτης που καταφέρει να πετάξει πρώτος όλα του τα χαρτιά.
-   Μπορούν να υπάρχουν παράλληλα πολλά τραπέζια/παιχνίδια.

## Το project

Το project υλοποιήθηκε στην **NodeJS** (https://nodejs.org/en/). Δημιουργήθηκε ένας web server, χωρίς τη χρήση GUI, με τη βοήθεια του **ExpressJS** framework (https://expressjs.com/). Όλα τα στοιχεία του παιχνιδιού αποθηκεύονται σε βάση **MySQL**.

Ο server αυτός προσφέρει ορισμένα endpoints με τη βοήθεια των οποίων μπορεί κάποιος να παίξει το παιχνίδι "Μπλόφα".

Η βάση και τα αρχικά απαραίτητα δεδομένα δημιουργούνται αυτόματα κατά την εκτέλεση του server (για μεγαλύτερη ευκολία).

## Προϋποθέσεις

-   Εγκατεστημένη **MySQL** locally
-   Εγκατεστημένη **NodeJS** + **npm** locally

## Αρχικά βήματα

1.  Αφού γίνει clone το repositoty, ανοίγουμε ένα terminal στο φάκελο που βρίσκεται το repository
2.  Τρέχουμε `npm install` μέσα στο φάκελο, για να εγκατασταθούν τα dependencies του project
3.  Ανάλογα με τις local ρυθμίσεις της MySQL, πρέπει να αλλαχτεί το connection config στον κώδικα, για να μπορέσουμε να συνδεθούμε στην local βάση
    1. Ο default χρήστης στον κώδικα είναι ο **root** (μπορεί να αλλαχθεί, όπως αναφέρουμε στο παράδειγμα)
    2. Αν η local βάση μας χρειάζεται **password**, τότε προσθέτουμε `password: 'myPass'` στην πρώτη παράμετρο της εντολής `mysql.createConnection`
    3. Παρομοίως το ίδιο κάνουμε και με την **port** στην οποία ακούει η MySQL
    4. Example:
        ```
        const connection = mysql.createConnection({
            user: 'root',
            password: 'myPass',
            port: 30000
        });
        ```
4.  `node ./bluff.js` για να ξεκινήσουμε τον server
5.  Ο server πλέον ακούει στο **localhost:30000**
    1. Όλα τα endpoints μπορούν να εκτελεστούν είτε κατευθείαν από τον browser, είτε με `curl`/`wget` είτε από το Postman, π.χ. `http://localhost:30000/rules`

## API documentation

Όλα τα παρακάτω endpoints επιστρέφουν **errors** σε περίπτωση που οι προαπαιτούμενοι παράμετροι είναι λάθος ή λείπουν.

-   `GET /rules`
    Επιστρέφει τους κανόνες του παιχνιδιού. Δεν χρειάζεται παραμέτρους.
-   `GET /login?name=`
    Χρησιμοποιείται για την αυθεντικοποίηση (δημιουργία) ενός χρήστη (χωρίς password).

    | Παράμετρος | Τύπος  | Περιγραφή           |
    | ---------- | ------ | ------------------- |
    | name       | String | Το όνομα του χρήστη |

    Επιστρέφει:
    `{ message, userId, name, availableGameIds }`

-   `GET /new-game?userId=`
    Χρησιμοποιείται για τη δημιουργία ενός καινούργιου τραπεζιού/παιχνιδιού.

    _Περιπτώσεις λάθους_:

    -   Ο χρήστης δεν υπάρχει στη βάση

    | Παράμετρος | Τύπος  | Περιγραφή        |
    | ---------- | ------ | ---------------- |
    | userId     | String | Το id του χρήστη |

    Επιστρέφει:
    `{ message, gameId }`

-   `GET /join-game?gameId=&userId=`
    Χρησιμοποιείται για τη συμμετοχή σε υπάρχον τραπέζι/παιχνίδι.

    _Περιπτώσεις λάθους:_

    -   Ο χρήστης δεν υπάρχει στη βάση
    -   Το παιχνίδι δεν υπάρχει στη βάση
    -   Ο χρήστης έχει μπει ήδη στο παιχνίδι
    -   Το παιχνίδι είναι γεμάτο

    | Παράμετρος | Τύπος  | Περιγραφή                      |
    | ---------- | ------ | ------------------------------ |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού |
    | userId     | String | Το id του χρήστη               |

    Επιστρέφει:
    `{ message, gameId, userId, userOrder }`

-   `GET /my-cards?gameId=&userId=`
    Χρησιμοποιείται για την εμφάνιση των χαρτιών συγκεκριμένου χρήστη για συγκεκριμένο τραπέζι/παιχνίδι.

    _Περιπτώσεις λάθους:_

    -   Ο χρήστης δεν υπάρχει στη βάση
    -   Το παιχνίδι δεν υπάρχει στη βάση

    | Παράμετρος | Τύπος  | Περιγραφή                      |
    | ---------- | ------ | ------------------------------ |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού |
    | userId     | String | Το id του χρήστη               |

    Επιστρέφει:
    `{ myCards, gameId, userId, allCards }`

-   `GET /throw?userId=&gameId=&quantity=&shape=&actual=`
    Χρησιμοποιείται για να παίξει ο χρήστης τη σειρά του πετώντας χαρτιά και κάνοντας μια δήλωση.

    _Περιπτώσεις λάθους:_

    -   Ο χρήστης δεν υπάρχει στη βάση
    -   Το παιχνίδι δεν υπάρχει στη βάση
    -   Η φιγούρα δεν υπάρχει
    -   Δεν είναι η σειρά του παίκτη \* Οι κάρτες που πετάει δεν του ανήκουν

    | Παράμετρος | Τύπος  | Περιγραφή                                                                           |
    | ---------- | ------ | ----------------------------------------------------------------------------------- |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού                                                      |
    | userId     | String | Το id του χρήστη                                                                    |
    | quantity   | String | Η ποσότητα των χαρτιών που πετούνται                                                |
    | shape      | String | Η φιγούρα της δήλωσης του χρήστη (π.χ. 2 ή Q)                                       |
    | actual     | String | Τα ids των χαρτιών που πετάει ο χρήστης από τις κάρτες του (comma-separated string) |

    Παράδειγμα:
    `GET /throw?userId=1&gameId=1&quantity=3&shape=Κ&actual=1,2,3`
    Ο χρήστης με **userId** 1, στο παιχνίδι με **gameId** 1 δηλώνει ότι θα πετάξει 3 (**quantity**) Κ (**shape**) (παπάδες) και οι πραγματικές κάρτες (**actual**) που πετάει έχουν ids 1, 2 και 3.

    Επιστρέφει:
    `{ message, myCards, gameId, userId }`

-   `GET /challenge?userId=&gameId=`
    Χρησιμοποιείται για να παίξει ο χρήστης τη σειρά του προκαλώντας τη δήλωση του προηγούμενου παίκτη. Αν η μπλόφα είναι αποτυχημένη, τότε τα χαρτιά της τελευταίας δήλωσης πάνε στον προηγούμενο παίκτη. Αλλιώς ο παίκτης που έκανε την πρόκληση παίρνει τα χαρτιά.

    _Περιπτώσεις λάθους:_

    -   Ο χρήστης δεν υπάρχει στη βάση
    -   Το παιχνίδι δεν υπάρχει στη βάση
    -   Δεν είναι η σειρά του παίκτη
    -   Δεν υπάρχει ακόμα δήλωση στο παιχνίδι (δεν έχει παίξει κανείς)

    | Παράμετρος | Τύπος  | Περιγραφή                      |
    | ---------- | ------ | ------------------------------ |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού |
    | userId     | String | Το id του χρήστη               |

    Επιστρέφει:
    `{ gameId, userId, result }`

-   `GET /last-declaration?gameId=`
    Χρησιμοποιείται για την εμφάνιση της τελευταίας δήλωσης ενός τραπεζιού/παιχνιδιού.

    _Περιπτώσεις λάθους:_

    -   Το παιχνίδι δεν υπάρχει στη βάση

    | Παράμετρος | Τύπος  | Περιγραφή                      |
    | ---------- | ------ | ------------------------------ |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού |

    Επιστρέφει:

    ```
    {
        lastDeclaration: {
            quantity,
            shape
        }
    }
    ```

-   `GET /status?gameId=`
    Χρησιμοποιείται για την εμφάνιση του status ενός τραπεζιού/παιχνιδιού.

    _Περιπτώσεις λάθους:_

    -   Το παιχνίδι δεν υπάρχει στη βάση

    | Παράμετρος | Τύπος  | Περιγραφή                      |
    | ---------- | ------ | ------------------------------ |
    | gameId     | String | Το id του τραπεζιού/παιχνιδιού |

    Επιστρέφει:

    ```
    {
       gameId,
       game: {
           winner,
           ongoing,
           creationDate,
           createdBy,
           players
       }
       // τα παρακάτω keys επιστρέφονται στην περίπτωση που δεν υπάρχει νικητής στο παιχνίδι
       nextPlayer,
       lastDeclaration: {
            quantity,
            shape
       }
    }
    ```

-   `GET /score` ή `GET /score?userId=`
    Χρησιμοποιείται για την εμφάνιση του score είτε όλων των παικτών είτε για έναν συγκεκριμένο παίκτη.

    | Παράμετρος | Τύπος  | Περιγραφή        |
    | ---------- | ------ | ---------------- |
    | userId     | String | Το id του χρήστη |

    Επιστρέφει:
    `{ scoreboard }`
